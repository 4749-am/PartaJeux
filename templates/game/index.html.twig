{% extends 'base.html.twig' %}

{% block title %}Jeux{% endblock %}

{% block body %}
<h1>Liste des jeux</h1>

<table class="cyberpunk-table">
    <thead>
        <tr>
            <th>Id</th>
            <th>Nom du jeu</th>
            <th>Description</th>
            <th>Ville</th>
            <th>Date et heure</th>
            <th>Latitude</th>
            <th>Longitude</th>
            <th>Places disponibles</th>
            <th>Créé par</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
    {% for jeu in jeux %}
        <tr>
            <td>{{ jeu.id }}</td>
            <td>{{ jeu.titre }}</td>
            <td>{{ jeu.description }}</td>
            <td>{{ jeu.ville }}</td>
            <td>{{ jeu.dateSoiree ? jeu.dateSoiree|date('d/m/Y H:i') : '' }}</td>
            <td>{{ jeu.latitude|number_format(6) }}</td>
            <td>{{ jeu.longitude|number_format(6) }}</td>
            <td><span class="badge-seats">{{ jeu.nombrePlaces }}</span></td>
            <td>{{ jeu.user.username }}</td>
            <td style="white-space: nowrap; text-align:center;">
                <div class="actions-cell" style="display:flex; justify-content:center; gap:10px;">
                    <a href="{{ path('app_game_show', {'id': jeu.id}) }}" class="btn-cyberpunk">Voir</a>
                    <a href="{{ path('app_game_edit', {'id': jeu.id}) }}" class="btn-cyberpunk">Modifier</a>
                </div>
            </td>
        </tr>
    {% else %}
        <tr>
            <td colspan="10" class="empty-message">Aucun jeu trouvé</td>
        </tr>
    {% endfor %}
    </tbody>
</table>

<h2>Carte des jeux</h2>
<div id="map" style="height: 400px;"></div>

<script
    src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-o9N1jRVvG8k3uLw3hPtEgwXJ9vZlwJ2j1dCtmD12CM0="
    crossorigin=""
></script>
<link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-o9N1jRVvG8k3uLw3hPtEgwXJ9vZlwJ2j1dCtmD12CM0="
    crossorigin=""
/>

<script>
    const map = L.map('map').setView([46.603354, 1.888334], 6); // centre France

    // Fond sombre
    const darkTiles = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
        attribution: '&copy; OpenStreetMap contributors',
        subdomains: 'abcd',
        maxZoom: 19
    }).addTo(map);

    // Marqueur néon purple
    const neonPurpleIcon = L.divIcon({
        html: `<svg xmlns="http://www.w3.org/2000/svg" width="30" height="40" viewBox="0 0 30 40">
                  <path d="M15 0C7 0 0 7 0 15c0 10 15 25 15 25s15-15 15-25C30 7 23 0 15 0z" fill="#9b59b6" stroke="white" stroke-width="1"/>
               </svg>`,
        className: "neon-marker",
        iconAnchor: [15, 40]
    });

    // Effet glow
    const style = document.createElement("style");
    style.textContent = `
      .neon-marker svg{
        filter: drop-shadow(0 0 6px #9b59b6) drop-shadow(0 0 12px #9b59b6);
      }
    `;
    document.head.appendChild(style);

    // Ajout des marqueurs et popup complet
    {% for jeu in jeux %}
        {% if jeu.latitude and jeu.longitude %}
            const marker{{ jeu.id }} = L.marker([{{ jeu.latitude }}, {{ jeu.longitude }}], {icon: neonPurpleIcon}).addTo(map);

            marker{{ jeu.id }}.bindPopup(`
                <b>{{ jeu.titre }}</b><br>
                {{ jeu.description }}<br>
                <b>Ville:</b> {{ jeu.ville }}<br>
                <b>Date et heure:</b> {{ jeu.dateSoiree ? jeu.dateSoiree|date('d/m/Y H:i') : '' }}<br>
                <b>Latitude:</b> {{ jeu.latitude|number_format(6) }}<br>
                <b>Longitude:</b> {{ jeu.longitude|number_format(6) }}<br>
                <b>Places disponibles:</b> {{ jeu.nombrePlaces }}<br>
                <b>Créé par:</b> {{ jeu.user.username }}
            `);
        {% endif %}
    {% endfor %}
</script>

<a href="{{ path('app_game_new') }}" class="btn-cyberpunk" style="margin-top:20px; display:inline-block;">Créer un nouveau jeu</a>

{% endblock %}
