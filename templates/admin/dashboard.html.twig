{% extends 'base.html.twig' %}

{% block title %}Tableau de bord administrateur{% endblock %}

{% block body %}
<div class="dashboard-wrap">
  <!-- En-tête -->
  <div class="header-row">
    <h1>Bienvenue, administrateur {{ app.user.username }}</h1>
    <p>Gérez les jeux, surveillez les inscriptions et créez de nouvelles soirées.</p>
    <div class="actions">
      <a href="{{ path('app_logout') }}" class="btn-cyberpunk">Se déconnecter</a>
      <a href="{{ path('app_game_index') }}" class="btn-cyberpunk">Voir tous les jeux</a>
    </div>
  </div>

  <!-- Création d’un nouveau jeu -->
  <div class="cyber-card">
    <h2 style="color:var(--neon-purple); text-align:center; margin-bottom:12px;">
      Créer un nouveau jeu
    </h2>

    {{ form_start(form, {'attr': {'class':'cyber-form'}, 'novalidate': 'novalidate'}) }}

    <div class="form-field">
      {{ form_label(form.titre, 'Nom du jeu') }}
      {{ form_widget(form.titre, {'attr': {'class':'cyber-input'}}) }}
      {{ form_errors(form.titre) }}
    </div>

    <div class="form-field">
      {{ form_label(form.description, 'Description') }}
      {{ form_widget(form.description, {'attr': {'class':'cyber-input'}}) }}
      {{ form_errors(form.description) }}
    </div>

    <div class="form-field">
      {{ form_label(form.ville, 'Ville') }}
      {{ form_widget(form.ville, {'attr': {'class':'cyber-input'}}) }}
      {{ form_errors(form.ville) }}
    </div>

    <div style="display:flex;gap:10px;flex-wrap:wrap;">
      <div style="flex:1; min-width:140px;">
        <div class="form-field">
          {{ form_label(form.latitude, 'Latitude') }}
          {{ form_widget(form.latitude, {'attr': {'class':'cyber-input'}}) }}
          {{ form_errors(form.latitude) }}
        </div>
      </div>
      <div style="flex:1; min-width:140px;">
        <div class="form-field">
          {{ form_label(form.longitude, 'Longitude') }}
          {{ form_widget(form.longitude, {'attr': {'class':'cyber-input'}}) }}
          {{ form_errors(form.longitude) }}
        </div>
      </div>
    </div>

    <div class="form-field">
      {{ form_label(form.dateSoiree, 'Date et heure de la soirée') }}
      {{ form_widget(form.dateSoiree, {'attr': {'class':'cyber-input'}}) }}
      {{ form_errors(form.dateSoiree) }}
    </div>

    <div class="form-field">
      {{ form_label(form.nombrePlaces, 'Nombre total de places') }}
      {{ form_widget(form.nombrePlaces, {'attr': {'class':'cyber-input'}}) }}
      {{ form_errors(form.nombrePlaces) }}
    </div>

    <div style="text-align:center; margin-top:10px;">
      <button type="submit" class="btn-cyberpunk">Créer le jeu</button>
    </div>

    {{ form_end(form) }}
  </div>

  <!-- Jeux créés par l’admin -->
  <div class="cyber-card">
    <h2 style="color:var(--neon-blue); text-align:center; margin-bottom:12px;">Vos jeux</h2>

    <table class="cyber-table" role="table" aria-label="Liste des jeux créés">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Ville</th>
          <th>Date</th>
          <th>Places disponibles</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for jeu in app.user.jeux %}
          <tr class="cyber-row">
            <td data-label="Nom">{{ jeu.titre }}</td>
            <td data-label="Ville">{{ jeu.ville }}</td>
            <td data-label="Date">{{ jeu.dateSoiree ? jeu.dateSoiree|date('d/m/Y H:i') : '' }}</td>
            <td data-label="Places">
              {{ jeu.getNombrePlacesRestantes() }} / {{ jeu.nombrePlaces }}
            </td>
            <td data-label="Actions" style="white-space: nowrap; text-align:center;">
              <div style="display:flex; justify-content:center; gap:10px;">
                <a href="{{ path('app_game_show', {'id': jeu.id}) }}" class="btn-cyberpunk" style="padding:6px 10px;">Voir</a>
                <a href="{{ path('app_game_edit', {'id': jeu.id}) }}" class="btn-cyberpunk" style="padding:6px 10px;">Modifier</a>
                <form action="{{ path('app_game_delete', {'id': jeu.id}) }}" method="post" onsubmit="return confirm('Supprimer ce jeu ?');">
                  <input type="hidden" name="_token" value="{{ csrf_token('delete' ~ jeu.id) }}">
                  <button type="submit" class="btn-cyberpunk" style="background-color:var(--neon-pink);padding:6px 10px;">Supprimer</button>
                </form>
              </div>
            </td>
          </tr>
        {% else %}
          <tr class="cyber-row">
            <td colspan="5" style="text-align:center; padding:18px;">Aucun jeu créé pour le moment.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

    <!-- Gestion des utilisateurs -->
  <div class="cyber-card" style="margin-top:30px;">
    <h2 style="color:var(--neon-green); text-align:center; margin-bottom:12px;">
      Gestion des utilisateurs
    </h2>

    <table class="cyber-table" role="table" aria-label="Liste des utilisateurs">
      <thead>
        <tr>
          <th>Utilisateur</th>
          <th>Email</th>
          <th>Statut</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr class="cyber-row">
            <td data-label="Utilisateur">{{ user.username }}</td>
            <td data-label="Email">{{ user.email }}</td>

            <td data-label="Statut">
              {% if user.isBanned %}
                <span style="color:#ff0044; font-weight:bold;">Banni</span>
              {% else %}
                <span style="color:#00ff88; font-weight:bold;">Actif</span>
              {% endif %}
            </td>

            <td data-label="Actions" style="white-space: nowrap; text-align:center;">
              <div style="display:flex; justify-content:center; gap:10px;">

                {# --- N’ADMIN PEUT PAS SE BANNIR LUI-MÊME --- #}
                {% if user.id != app.user.id %}

                  {% if user.isBanned %}
                    <form action="{{ path('admin_user_unban', {'id': user.id}) }}" method="post"
                          onsubmit="return confirm('Débannir cet utilisateur ?');">
                      <input type="hidden" name="_token" value="{{ csrf_token('unban' ~ user.id) }}">
                      <button type="submit" class="btn-cyberpunk"
                              style="background-color:#00cc66; padding:6px 10px;">
                        Débannir
                      </button>
                    </form>
                  {% else %}
                    <form action="{{ path('admin_user_ban', {'id': user.id}) }}" method="post"
                          onsubmit="return confirm('Bannir cet utilisateur ?');">
                      <input type="hidden" name="_token" value="{{ csrf_token('ban' ~ user.id) }}">
                      <button type="submit" class="btn-cyberpunk"
                              style="background-color:#ff0044; padding:6px 10px;">
                        Bannir
                      </button>
                    </form>
                  {% endif %}

                {% else %}
                  <span style="opacity:0.6;">(vous)</span>
                {% endif %}

              </div>
            </td>
          </tr>

        {% else %}
          <tr class="cyber-row">
            <td colspan="4" style="text-align:center; padding:18px;">Aucun utilisateur trouvé.</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

</div>
{% endblock %}
